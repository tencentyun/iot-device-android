# 优图人脸活体-红外文档 FACE-LIVE-IR

> 输入红外图进行活体检测

version: v2.2.1

## CHANGELIST

### v2.2.1

- [新增]：getScores，可以获得 detect 的**全部**分数结果，注意需要在 detect 之后立即获取

### v2.2.0

- [优化]：红外模型升级至 v200，与旧的模型不兼容

### v2.1.2

- [优化]：接口调整

### v2.1.1

- [新增]：getScore，可以获得 detect 的分数结果，注意需要在 detect 之后立即获取

### v2.1.0

- [不兼容更新]：detect 输入为人脸框和红外图 RGB888 数据，输出为 `true/false`
- [新增]：阈值默认放置 config.ini 文件中，通过静态方法 setThresholds 设置模型的阈值

## Java

package: com.tencent.youtu.YTFaceLiveIR

### 通用接口

- static String getVersion();
    - @brief 获得 SDK + MODEL 的版本号，如`v3.0.0-v7114`
        - MODEL 的版本号由 `config.ini` 中读取获得
        - SDK 的版本号一般为 `v3.0.0`/`v3.0.0-beta.0`/`v3.1.1-rc.0`
    - @return 版本号

- static int globalInit(String modelDirpath, String configFilename);
    - @brief 全局初始化函数，初始化模型，进程初始化一次即可，多线程不安全
    - @param `modelDirpath` 模型所在外部存储空间的绝对路径
    - @param `configFilename` 模型所在外部存储控件路径下 config 的文件名，如 `config.ini`
    - @return `< 0` 失败

- static int globalInit(AssetManager assetManager, String modelDirpath, String configFilename);
    - @brief 全局初始化函数，初始化模型，进程初始化一次即可，多线程不安全
    - @param `assetManager` Android 管理 `Assets` 类，可通过 `this.getAssets()` 获得
    - @param `modelDirpath` 模型所在 `Assets` 存储下的相对路径
    - @param `configFilename` 模型所在 `Assets` 存储下的相对路径下 config 的文件名，如 `config.ini`
    - @return `< 0` 失败

- static void globalRelease();
    - @brief 全局析构函数，进程结束析构一次即可，多线程不安全

- static int setThresholds(float[] thresholds);
    - @brief 动态更改活体模型的比对阈值，一般可以采用默认阈值，默认阈值在 models/config.ini 下配置
    - @param `thresholds` 默认阈值，如有需要，请咨询优图人员，**前面的阈值必须要小于后面的阈值**
    - @return 返回是否设置成功，`!= 0` 失败， `== 0` 成功

- void destroy();
    - @brief 每一个 new 出的实例，都需要明确的 destroy()。防止内存泄漏。

### 功能接口

- boolean detect(float[] colorXY5Points, byte[] colorData, int colorWidth, int colorHeight, float[] irXY5Points, byte[] irData, int irWidth, int irHeight);
    - @brief 人脸 红外 活体判断打分，多线程安全，每个线程需要构建新的实例。
    - @param `colorXY5Points` 彩色图人脸关键五点[左眼中心，右眼中心，鼻尖，左嘴角，右嘴角]
    - @param `colorData` 彩色图的图像数据
    - @param `colorWidth` 彩色图的宽
    - @param `colorHeight` 彩色图的高
    - @param `irXY5Points` 红外图人脸关键五点[左眼中心，右眼中心，鼻尖，左嘴角，右嘴角]
    - @param `irData` 红外图的 RGB888 格式的图像数据
    - @param `irWidth` 红外图的宽
    - @param `irHeight` 红外图的高
    - @return 人脸红外活体判断是否为真人，`true` 为真人，`false` 为攻击

- float getScore();
    - @brief 获得 detect 过程中得到的**最终**模型的分数。如有需要，请在 detect 后立即串行调用。
    - @return 分数。当第一层分数小于第一层阈值的时候，返回第一层分数，否则返回第二层分数。**要求第一层阈值必须小于第二层阈值**。

- float[] getScores();
    - @brief 获得 detect 过程中得到的**所有**模型的分数。请在 detect 后立即串行调用。
    - @return 分数数组
